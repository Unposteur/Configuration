<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Ma Config PC</title>
    <style>
      body { font-family: Arial, sans-serif; background-color: #f4f6f8; margin: 0; padding: 40px; }
      h1, h2.section-title { text-align: center; color: #222; }
      .container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 25px; margin-bottom: 50px; }
      .card { background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); overflow: hidden; transition: 0.2s; }
      .card:hover { transform: translateY(-5px); }
      .card-image { display: flex; align-items: center; justify-content: center; height: 220px; background: #fff; padding: 10px; }
      .card img { max-width: 100%; max-height: 100%; object-fit: contain; }
      .card-content { padding: 20px; }
      .card-content h3 { margin: 0 0 8px; font-size: 18px; }
      .merchant { font-size: 14px; color: #666; margin-bottom: 15px; }
      .card-content a { display: inline-block; padding: 10px 15px; background: #0073e6; color: white; text-decoration: none; border-radius: 6px; }
      .card-content a:hover { background: #005bb5; }
      .extra-section { border-top: 2px solid #ddd; padding-top: 20px; }
      #openToolBtn { position: fixed; bottom: 20px; right: 20px; padding: 12px 16px; background: #0073e6; color: white; border: none; border-radius: 8px; cursor: pointer; z-index: 1000; }
      .tool-box { position: fixed; bottom: 70px; right: 20px; width: 320px; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: none; z-index: 999; }
      .tool-box input, .tool-box select { width: 100%; margin-bottom: 10px; padding: 10px; }
      .tool-box button { width: 100%; padding: 12px; background: #0073e6; color: white; border: none; border-radius: 6px; cursor: pointer; }
      .tool-box button:hover { background: #005bb5; }
    </style>
  </head>
  <body>
    <h1>Ma Config PC</h1>
    <h2 class="section-title">Composants principaux</h2>
    <div class="container" id="main-container"></div>

    <div class="extra-section">
      <h2 class="section-title">Les +</h2>
      <div class="container" id="extra-container"></div>
    </div>

    <button onclick="toggleTool()" id="openToolBtn">⚙️ Modifier la config</button>

    <div class="tool-box" id="toolBox">
      <h3>Ajouter un composant</h3>
      <input id="nom" placeholder="Nom du composant" />
      <input id="image" placeholder="Lien image" />
      <input id="lien" placeholder="Lien produit" />
      <input id="marchand" placeholder="Marchand" />
      <select id="categorie">
        <option value="main">Composant principal</option>
        <option value="extra">Les +</option>
      </select>
      <button onclick="ajouterComposant()">Ajouter</button>
    </div>

    <!-- LZString pour compression -->
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>

    <script>
      // Fonction pour récupérer et décoder les données depuis l'URL
      function getDataFromURL(key) {
        const params = new URLSearchParams(window.location.search);
        const compressed = params.get(key);
        if (!compressed) return [];
        try {
          return JSON.parse(LZString.decompressFromEncodedURIComponent(compressed)) || [];
        } catch (e) {
          return [];
        }
      }

      let mainData = getDataFromURL("mainData");
      let extraData = getDataFromURL("extraData");

      afficher();

      function toggleTool() {
        const tool = document.getElementById("toolBox");
        tool.style.display = tool.style.display === "none" ? "block" : "none";
      }

      function updateURL() {
        const params = new URLSearchParams();
        params.set("mainData", LZString.compressToEncodedURIComponent(JSON.stringify(mainData)));
        params.set("extraData", LZString.compressToEncodedURIComponent(JSON.stringify(extraData)));
        const newUrl = `${window.location.origin}${window.location.pathname}?${params.toString()}`;
        window.history.replaceState(null, "", newUrl);
      }

      function ajouterComposant() {
        const nom = document.getElementById("nom").value.trim();
        const image = document.getElementById("image").value.trim();
        const lien = document.getElementById("lien").value.trim();
        const marchand = document.getElementById("marchand").value.trim();
        const categorie = document.getElementById("categorie").value;

        if (!nom || !image || !lien || !marchand) {
          alert("Merci de remplir tous les champs");
          return;
        }

        const objet = { nom, image, lien, marchand };

        if (categorie === "main") mainData.push(objet);
        else extraData.push(objet);

        updateURL();

        document.getElementById("nom").value = "";
        document.getElementById("image").value = "";
        document.getElementById("lien").value = "";
        document.getElementById("marchand").value = "";

        afficher();
      }

      function afficher() {
        const mainContainer = document.getElementById("main-container");
        const extraContainer = document.getElementById("extra-container");
        mainContainer.innerHTML = "";
        extraContainer.innerHTML = "";

        mainData.forEach(item => creerCard(item, mainContainer));
        extraData.forEach(item => creerCard(item, extraContainer));
      }

      function creerCard(item, container) {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="card-image">
            <img src="${item.image}" alt="${item.nom}">
          </div>
          <div class="card-content">
            <h3>${item.nom}</h3>
            <div class="merchant">${item.marchand}</div>
            <a href="${item.lien}" target="_blank">Voir produit</a>
          </div>
        `;
        container.appendChild(card);
      }
    </script>
  </body>
</html>
